rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Events collection
    match /events/{eventId} {
      // Anyone can read a single event if it's published.
      // Needed for the public event registration page.
      allow get: if resource.data.status == 'published';

      // Authenticated users can read any event and list all events.
      // Needed for the dashboard, events list, and event management pages.
      allow list, get: if request.auth != null;
      
      // Only authenticated users can create, update, or delete events.
      allow create, update, delete: if request.auth != null;

      // Attendees subcollection
      match /attendees/{attendeeId} {
        // Anyone can register as an attendee for an event.
        allow create: if true;
        
        // Only authenticated users (the event manager) can see the list of attendees.
        allow read, list: if request.auth != null;
      }
    }
  }
}
